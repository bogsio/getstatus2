{% extends 'base.html' %}

{% block title %}System Status{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8">
    <!-- Header -->
    <header class="text-center mb-8">
        {% if settings.logo %}
            <img src="{{ settings.logo.url }}" alt="{{ settings.company_name }}" class="h-12 w-auto mx-auto mb-3">
        {% else %}
            <h1 class="text-2xl font-bold text-gray-900 mb-1">{{ settings.company_name }}</h1>
        {% endif %}
        <p class="text-gray-500 text-sm">System Status</p>
    </header>

    <!-- Overall Status Banner -->
    <div class="mb-8 rounded-lg p-4 text-white text-center font-medium
        {% if overall_status == 'operational' %}bg-operational
        {% elif overall_status == 'degraded' %}bg-degraded
        {% elif overall_status == 'partial' %}bg-partial
        {% elif overall_status == 'major' %}bg-major
        {% elif overall_status == 'maintenance' %}bg-maintenance
        {% endif %}">
        <div class="flex items-center justify-center gap-2">
            {% if overall_status == 'operational' %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            {% else %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
            {% endif %}
            <span>{{ overall_message }}</span>
        </div>
    </div>

    <!-- Active Incidents -->
    {% if active_incidents %}
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Active Incidents</h2>
        <div class="space-y-4">
            {% for incident in active_incidents %}
            <div class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden" x-data="{ open: true }">
                <button @click="open = !open" class="w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50">
                    <div class="flex items-center gap-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            {% if incident.impact == 'critical' %}bg-red-100 text-red-800
                            {% elif incident.impact == 'major' %}bg-orange-100 text-orange-800
                            {% elif incident.impact == 'minor' %}bg-yellow-100 text-yellow-800
                            {% else %}bg-gray-100 text-gray-800
                            {% endif %}">
                            {{ incident.get_impact_display }}
                        </span>
                        <span class="font-medium text-gray-900">{{ incident.title }}</span>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div x-show="open" x-cloak class="border-t border-gray-100">
                    {% for update in incident.updates.all %}
                    <div class="px-4 py-3 {% if not forloop.last %}border-b border-gray-50{% endif %}">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-medium uppercase
                                {% if update.status == 'investigating' %}text-yellow-600
                                {% elif update.status == 'identified' %}text-orange-600
                                {% elif update.status == 'monitoring' %}text-blue-600
                                {% else %}text-green-600
                                {% endif %}">
                                {{ update.get_status_display }}
                            </span>
                            <span class="text-xs text-gray-400">{{ update.created_at|date:"M d, H:i" }}</span>
                        </div>
                        <p class="text-sm text-gray-600">{{ update.message }}</p>
                    </div>
                    {% empty %}
                    <div class="px-4 py-3 text-sm text-gray-500">
                        No updates yet.
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Services -->
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Services</h2>
        <div class="bg-white rounded-lg border border-gray-200 shadow-sm divide-y divide-gray-100">
            {% for item in services %}
            <div class="px-4 py-3">
                <div class="flex items-center justify-between mb-2">
                    <div>
                        <span class="font-medium text-gray-900">{{ item.service.name }}</span>
                        {% if item.service.description %}
                        <p class="text-sm text-gray-500">{{ item.service.description }}</p>
                        {% endif %}
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-sm
                            {% if item.service.status == 'operational' %}text-operational
                            {% elif item.service.status == 'degraded' %}text-degraded
                            {% elif item.service.status == 'partial' %}text-partial
                            {% elif item.service.status == 'major' %}text-major
                            {% elif item.service.status == 'maintenance' %}text-maintenance
                            {% endif %}">
                            {{ item.service.get_status_display }}
                        </span>
                        <span class="w-3 h-3 rounded-full
                            {% if item.service.status == 'operational' %}bg-operational
                            {% elif item.service.status == 'degraded' %}bg-degraded
                            {% elif item.service.status == 'partial' %}bg-partial
                            {% elif item.service.status == 'major' %}bg-major
                            {% elif item.service.status == 'maintenance' %}bg-maintenance
                            {% endif %}">
                        </span>
                    </div>
                </div>
                <!-- 24-hour uptime bar -->
                <div class="flex gap-0.5">
                    {% for h in item.history %}
                    <div class="flex-1 h-6 rounded-sm cursor-pointer transition-opacity hover:opacity-80
                        {% if h.status == 'operational' %}bg-operational
                        {% elif h.status == 'degraded' %}bg-degraded
                        {% elif h.status == 'partial' %}bg-partial
                        {% elif h.status == 'major' %}bg-major
                        {% elif h.status == 'maintenance' %}bg-maintenance
                        {% endif %}"
                        title="{{ h.hour|date:'M d, H:i' }} - {{ h.status|title }}{% if h.incident %}: {{ h.incident }}{% endif %}">
                    </div>
                    {% endfor %}
                </div>
                <div class="flex justify-between text-xs text-gray-400 mt-1">
                    <span>24 hours ago</span>
                    <span>Now</span>
                </div>
            </div>
            {% empty %}
            <div class="px-4 py-8 text-center text-gray-500">
                No services configured yet.
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Resolved Incidents -->
    {% if resolved_incidents %}
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Past Incidents</h2>
        <div class="space-y-4">
            {% for incident in resolved_incidents %}
            <div class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden" x-data="{ open: false }">
                <button @click="open = !open" class="w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50">
                    <div class="flex items-center gap-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Resolved
                        </span>
                        <span class="font-medium text-gray-900">{{ incident.title }}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-sm text-gray-400">{{ incident.resolved_at|date:"M d" }}</span>
                        <svg class="w-5 h-5 text-gray-400 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                </button>
                <div x-show="open" x-cloak class="border-t border-gray-100">
                    {% for update in incident.updates.all %}
                    <div class="px-4 py-3 {% if not forloop.last %}border-b border-gray-50{% endif %}">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-medium uppercase
                                {% if update.status == 'investigating' %}text-yellow-600
                                {% elif update.status == 'identified' %}text-orange-600
                                {% elif update.status == 'monitoring' %}text-blue-600
                                {% else %}text-green-600
                                {% endif %}">
                                {{ update.get_status_display }}
                            </span>
                            <span class="text-xs text-gray-400">{{ update.created_at|date:"M d, H:i" }}</span>
                        </div>
                        <p class="text-sm text-gray-600">{{ update.message }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Footer -->
    <footer class="text-center text-sm text-gray-400 pt-4 border-t border-gray-200">
        <p>
            {% if settings.company_url %}
                <a href="{{ settings.company_url }}" class="hover:text-gray-600" target="_blank">{{ settings.company_name }}</a> |
            {% else %}
                {{ settings.company_name }} |
            {% endif %}
            Powered by GetStatus2 | <a href="{% url 'status:dashboard_login' %}" class="hover:text-gray-600">Login</a>
        </p>
    </footer>
</div>
{% endblock %}
